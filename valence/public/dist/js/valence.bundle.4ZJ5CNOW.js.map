{
  "version": 3,
  "sources": ["../../../../../apps/valence/valence/public/js/transaction.js"],
  "sourcesContent": ["erpnext.TransactionController = class TransactionController extends erpnext.TransactionController {\n    make_quality_inspection() {\n\t\tlet data = [];\n\t\tconst fields = [\n\t\t\t{\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tfieldname: \"items\",\n\t\t\t\tcannot_add_rows: true,\n\t\t\t\tin_place_edit: true,\n\t\t\t\tdata: data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"docname\",\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Read Only\",\n\t\t\t\t\t\tfieldname: \"item_code\",\n\t\t\t\t\t\tlabel: __(\"Item Code\"),\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Read Only\",\n\t\t\t\t\t\tfieldname: \"item_name\",\n\t\t\t\t\t\tlabel: __(\"Item Name\"),\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"qty\",\n\t\t\t\t\t\tlabel: __(\"Accepted Quantity\"),\n\t\t\t\t\t\tin_list_view: true,\n\t\t\t\t\t\tread_only: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"sample_size\",\n\t\t\t\t\t\tlabel: __(\"Sample Size\"),\n\t\t\t\t\t\treqd: true,\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"description\",\n\t\t\t\t\t\tlabel: __(\"Description\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"serial_no\",\n\t\t\t\t\t\tlabel: __(\"Serial No\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"batch_no\",\n\t\t\t\t\t\tlabel: __(\"Batch No\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\", //Finbyz Changes\n\t\t\t\t\t\tfieldname: \"ref_item\", //Finbyz Changes\n\t\t\t\t\t\tlabel: __(\"Ref Item\"), //Finbyz Changes\n\t\t\t\t\t\thidden: true //Finbyz Changes\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname:\"concentration\", //Finbyz Changes\n\t\t\t\t\t\tfieldtype:\"Percent\", //Finbyz Changes\n\t\t\t\t\t\tlabel:__(\"Concentration\"), //Finbyz Changes\n\t\t\t\t\t\thidden: true //Finbyz Changes\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"lot_no\", //Finbyz Changes\n\t\t\t\t\t\tfieldtype: \"Data\", //Finbyz Changes\n\t\t\t\t\t\tlabel: __(\"Lot No\"), //Finbyz Changes\n\t\t\t\t\t\thidden: true //Finbyz Changes\n\t\t\t\t\t},\n                    {\n\t\t\t\t\t\tfieldname: \"ar_no\", //Finbyz Changes\n\t\t\t\t\t\tfieldtype: \"Data\", //Finbyz Changes\n\t\t\t\t\t\tlabel: __(\"AR No\"), //Finbyz Changes\n\t\t\t\t\t\thidden: true //Finbyz Changes\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t];\n\n\t\tconst me = this;\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Select Items for Quality Inspection\"),\n\t\t\tfields: fields,\n\t\t\tprimary_action: function () {\n\t\t\t\tconst data = dialog.get_values();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.controllers.stock_controller.make_quality_inspections\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\tdocname: me.frm.doc.name,\n\t\t\t\t\t\titems: data.items\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r.message.length > 0) {\n\t\t\t\t\t\t\tif (r.message.length === 1) {\n\t\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Quality Inspection\", r.message[0]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\t\t\t\t\t\"reference_name\": me.frm.doc.name\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tfrappe.set_route(\"List\", \"Quality Inspection\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Create\")\n\t\t});\n\n\t\tthis.frm.doc.items.forEach(item => {\n\t\t\tif (this.has_inspection_required(item)) {\n\t\t\t\tlet dialog_items = dialog.fields_dict.items;\n\t\t\t\tdialog_items.df.data.push({\n\t\t\t\t\t\"docname\": item.name,\n\t\t\t\t\t\"item_code\": item.item_code,\n\t\t\t\t\t\"item_name\": item.item_name,\n\t\t\t\t\t\"qty\": item.qty,\n\t\t\t\t\t\"description\": item.description,\n\t\t\t\t\t\"serial_no\": item.serial_no,\n\t\t\t\t\t\"batch_no\": item.batch_no,\n\t\t\t\t\t\"sample_size\": item.sample_quantity,\n\t\t\t\t\t\"ref_item\": item.name, //Finbyz Changes\n\t\t\t\t\t\"concentration\": item.concentration, //Finbyz Changes\n\t\t\t\t\t\"lot_no\": item.lot_no, //Finbyz Changes\n                    \"ar_no\":item.ar_no,\n\t\t\t\t});\n\t\t\t\tdialog_items.grid.refresh();\n\t\t\t}\n\t\t});\n\n\t\tdata = dialog.fields_dict.items.df.data;\n\t\tif (!data.length) {\n\t\t\tfrappe.msgprint(__(\"All items in this document already have a linked Quality Inspection.\"));\n\t\t} else {\n\t\t\tdialog.show();\n\t\t}\n\t}\n\n\thas_inspection_required(item) {\n\t\tif (this.frm.doc.doctype === \"Stock Entry\" && this.frm.doc.purpose == \"Manufacture\" ) {\n\t\t\tif ((item.is_finished_item || item.is_scrap_item) && !item.quality_inspection) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else if (!item.quality_inspection) {\n\t\t\treturn true;\n\t\t}\n\t}\n}"],
  "mappings": "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",
  "names": ["data"]
}
